---
title: 从文档谈到代码工程化
date: 2021-11-06T19:17:22+08:00
draft: false
categories:
- 随笔
tags:
- 随笔
---


今天跟同事谈到了 swagger 的问题。 swagger 很方便的一点在于可以从代码抽离出文档。它的便利性我不否认，但我要争论的点在于，即使有了 swagger ，我们仍然要维护一份文档，这份文档是提供给前端的，仅限当前业务的文档。我在阐述的时候其实也没有阐释的很清楚，所以现在我阐释一下其中的一些想法。

## 活于业务的文档

严格来说，其实只有一份文档是永久的，就是从代码抽离出的对代码阐释的文档，我为什么要说还要维护一份文档呢？而且这份文档仅限当前业务有效？首先，这份文档产生是顺序的。它是先于代码产生的，除非前端等后端写完代码，否则这种接口约定是不可避免的。而 swagger 是**针对代码生成文档的工具**，也就是说，想要有文档，你就得现写代码，但是开发还没开始，就因为需要写文档而产生不必要的提交，这是在污染代码仓库。仓库不是垃圾场，这是其一。

第二点——他真的非常喜欢拿变动说事——文档最大的作用，以预先的变动以减少变动，从而让可能被预防的变动提前预防。因为害怕变动从而完全不约定是最大的极端，这恰恰无法抵御所带来的危害，恰恰是在逃避变动。正确的方式是，至少要把我所能考虑到的变动尽量考虑清楚，确定情况，而不是放弃思考。至于实际开发中的情况谁也无法预料，但不能因为无法预料而放弃当下，难道说人因为随时会死就要立刻自杀吗？

第三点，此种预先的文档本来就是理清思路的工具，它也可以让开发人员去考虑使用者的情况，从而开发出合适的接口。这种预先的沟通本来就是为了防止后续的一种情况，就是有人不管不顾开发了一个接口，自己开发轻松了，给使用者造成了很大的麻烦。约定、沟通本来就是双方的妥协，如果为了不妥协而做出这种事情，那对团队来说是危害极大的。

第四点，文档作为预先的约束方便双方进行后续的交付。毕竟以人为交付对象比以文档作为交付对象要好得多。而且前端可以做 mock ，更加方便。

## 始于庙算

说实话，谈论这个问题我是很生气的。当前我们团队在文档上有所欠缺，其实都还蛮正常的，但谈论到用 swagger 完全取消预先的接口设计文档，我觉得这是一种懒惰。这种接口设计文档是需要被认真对待的，它是整个系统设计的重要一环，是开发的前奏，而 swagger 则是用于开发之后了，在这一点上没有意识是对整个系统设计缺乏认识，很容易开发出不完善的接口。

其次，我们考虑接口设计需要与他人沟通约定，是为了让大家的开发尽可能达到高效。每个人的视角有限，因此，我们需要他人的意见，来完善我们的视角。因此，我们将业务上可能需要的、有变动的文档提出来，专门给他们看，而不是傲慢地把文档扔给他人，然后扔几个 API 名，难道他们是捡来的吗？

## 工程化

最后，终于谈到我所理解的工程化了。随着工程越大，人与人之间的沟通越来越困难，所以，我觉得文档化实际上就是这种沟通的转嫁，就是沟通的实体化。一切工程化的目的都在于，即使其中一个人被替换，他也能迅速根据代码或文档接手他的工作。当工程庞大了，内部之间的沟通就变得复杂，即使是文档也无法完全弄清楚，因此，模块化的意义也就出现了。当两个功能互相调用意味着一次沟通，模块就意味着非常集中的、在特定开发人群之间的沟通，模块化使得沟通变得分布，最庞大的工程，必然是去中心的。

当然，以上只是我的一些猜想，毕竟我目前还没有见到过什么非常成功的工程化案例。工程化不能仅仅只是代码，也要包括设计。
